<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student List - High School</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      :root {
        --primary-color: #3498db;
        --secondary-color: #2c3e50;
        --accent-color: #e74c3c;
        --success-color: #27ae60;
        --warning-color: #f39c12;
        --light-bg: #f8f9fa;
        --card-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        --hover-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--light-bg);
        color: #333;
      }

      .navbar {
        background: linear-gradient(135deg, var(--primary-color), #2980b9);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        padding: 12px 0;
      }

      .navbar-brand {
        font-weight: 700;
        font-size: 1.5rem;
      }

      .section-title {
        position: relative;
        margin-bottom: 40px;
        padding-bottom: 20px;
        font-weight: 700;
        color: var(--secondary-color);
      }

      .section-title:after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 4px;
        background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
        border-radius: 2px;
      }
      
      .stats-container {
        background: white;
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 30px;
        box-shadow: var(--card-shadow);
        border: 1px solid rgba(0, 0, 0, 0.05);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      
      .stats-container:hover {
        transform: translateY(-5px);
        box-shadow: var(--hover-shadow);
      }
      
      .stat-card {
        text-align: center;
        padding: 20px 15px;
        border-radius: 12px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        position: relative;
        overflow: hidden;
      }
      
      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      }
      
      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
      }
      
      .stat-card.total {
        background: linear-gradient(135deg, #e3f2fd, #bbdefb);
        border: none;
      }
      
      .stat-card.total::before {
        background: var(--primary-color);
      }
      
      .stat-card.grade {
        background: linear-gradient(135deg, #fff3e0, #ffe0b2);
        border: none;
      }
      
      .stat-card.grade::before {
        background: var(--warning-color);
      }
      
      .stat-number {
        font-size: 2.2rem;
        font-weight: 700;
        margin-bottom: 5px;
        color: var(--secondary-color);
      }
      
      .stat-label {
        font-size: 0.95rem;
        color: #666;
        font-weight: 500;
      }

      @media (min-width: 768px) {
        .table-responsive {
          border-radius: 16px;
          overflow: hidden;
          box-shadow: var(--card-shadow);
          border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .table thead {
          background: linear-gradient(135deg, var(--primary-color), #2980b9);
          color: white;
        }
        
        .table thead th {
          border: none;
          padding: 16px 12px;
          font-weight: 600;
          text-align: center;
        }
        
        .table tbody td {
          padding: 14px 12px;
          vertical-align: middle;
          border-color: rgba(0, 0, 0, 0.05);
          text-align: center;
        }
        
        .table tbody tr {
          transition: all 0.2s ease;
        }
        
        .table tbody tr:hover {
          background-color: #f1f9ff;
          transform: scale(1.002);
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.03);
        }
      }

      footer {
        background: linear-gradient(135deg, var(--secondary-color), #1a252f);
        color: white;
        padding: 40px 0 20px;
        margin-top: 60px;
      }

      .student-photo {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #e9ecef;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }
      
      .student-photo:hover {
        transform: scale(1.1);
        border-color: var(--primary-color);
      }

      .action-buttons {
        white-space: nowrap;
      }
      
      .btn {
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      
      .btn-sm {
        padding: 0.4rem 0.8rem;
        font-size: 0.875rem;
        border-radius: 6px;
      }
      
      .btn-sm i {
        margin-right: 0.3rem;
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--primary-color), #2980b9);
        border: none;
      }
      
      .btn-primary:hover {
        background: linear-gradient(135deg, #2980b9, var(--primary-color));
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(52, 152, 219, 0.3);
      }

      .btn-info {
        background: linear-gradient(135deg, #17a2b8, #138496);
        border: none;
      }
      
      .btn-info:hover {
        background: linear-gradient(135deg, #138496, #17a2b8);
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(23, 162, 184, 0.3);
      }

      .btn-danger {
        background: linear-gradient(135deg, var(--accent-color), #c0392b);
        border: none;
      }
      
      .btn-danger:hover {
        background: linear-gradient(135deg, #c0392b, var(--accent-color));
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(231, 76, 60, 0.3);
      }

      /* Update Button Styling */
      .btn-update {
        background: linear-gradient(135deg, var(--warning-color), #e67e22);
        border: none;
        color: white;
      }
      
      .btn-update:hover {
        background: linear-gradient(135deg, #e67e22, var(--warning-color));
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(243, 156, 18, 0.3);
      }

      .btn-success {
        background: linear-gradient(135deg, var(--success-color), #219653);
        border: none;
      }
      
      .btn-success:hover {
        background: linear-gradient(135deg, #219653, var(--success-color));
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(39, 174, 96, 0.3);
      }

      .modal-header {
        background: linear-gradient(135deg, var(--primary-color), #2980b9);
        color: white;
        border-bottom: none;
        padding: 20px;
      }
      
      .modal-update-header {
        background: linear-gradient(135deg, var(--warning-color), #e67e22);
        color: white;
        border-bottom: none;
        padding: 20px;
      }

      .modal-danger-header {
        background: linear-gradient(135deg, var(--accent-color), #c0392b);
        color: white;
        border-bottom: none;
        padding: 20px;
      }

      .modal-photo {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        object-fit: cover;
        margin: 0 auto 20px;
        display: block;
        border: 4px solid var(--primary-color);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      
      .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255,255,255,.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
        margin-right: 10px;
      }
      
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      
      /* Form Styling */
      .form-control, .form-select {
        border-radius: 8px;
        border: 2px solid #e9ecef;
        padding: 0.75rem 1rem;
        transition: all 0.3s ease;
      }
      
      .form-control:focus, .form-select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
      }
      
      .input-group .btn {
        border-radius: 0 8px 8px 0;
      }
      
      .input-group .form-control {
        border-radius: 8px 0 0 8px;
      }

      /* Update Form Styling */
      .update-form-group {
        margin-bottom: 1.5rem;
        position: relative;
      }
      
      .update-form-group label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 0.5rem;
        display: block;
      }
      
      .update-form-control {
        border-radius: 8px;
        border: 2px solid #e9ecef;
        padding: 0.75rem 1rem;
        transition: all 0.3s ease;
      }
      
      .update-form-control:focus {
        border-color: var(--warning-color);
        box-shadow: 0 0 0 0.2rem rgba(243, 156, 18, 0.25);
      }
      
      .update-form-control:read-only {
        background-color: #f8f9fa;
        opacity: 0.7;
      }
      
      /* Button Group Styling */
      .action-buttons .btn {
        margin-right: 0.3rem;
        margin-bottom: 0.3rem;
      }
      
      /* Pagination Styling */
      .pagination-container {
        display: flex;
        justify-content: center;
        margin-top: 30px;
      }
      
      .page-link {
        border-radius: 8px;
        margin: 0 3px;
        border: 1px solid #dee2e6;
        color: var(--primary-color);
        font-weight: 500;
        transition: all 0.3s ease;
      }
      
      .page-link:hover {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
        transform: translateY(-2px);
      }
      
      .page-item.active .page-link {
        background: linear-gradient(135deg, var(--primary-color), #2980b9);
        border-color: var(--primary-color);
      }
      
      .pagination-info {
        text-align: center;
        margin-top: 15px;
        color: #6c757d;
        font-weight: 500;
      }
      
      /* Progress Bar Styling */
      .progress-container {
        margin: 20px 0;
        background: white;
        border-radius: 16px;
        padding: 20px;
        box-shadow: var(--card-shadow);
      }
      
      .progress {
        height: 20px;
        border-radius: 10px;
        background-color: #e9ecef;
        overflow: hidden;
      }
      
      .progress-bar {
        background: linear-gradient(135deg, var(--primary-color), #2980b9);
        border-radius: 10px;
      }
      
      /* Card styling for sections */
      .section-card {
        background: white;
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: var(--card-shadow);
        border: 1px solid rgba(0, 0, 0, 0.05);
      }
      
      /* Search and filter section */
      .search-filter-section {
        background: white;
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 30px;
        box-shadow: var(--card-shadow);
        border: 1px solid rgba(0, 0, 0, 0.05);
      }
      
      /* Responsive adjustments */
      @media (max-width: 576px) {
        .action-buttons {
          display: flex;
          flex-direction: column;
        }
        
        .action-buttons .btn {
          margin-right: 0;
          margin-bottom: 0.3rem;
          width: 100%;
        }
        
        .section-title {
          font-size: 1.5rem;
        }
        
        .stats-container, .search-filter-section {
          padding: 20px 15px;
        }
      }
      
      /* Animation for table rows */
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      .table tbody tr {
        animation: fadeIn 0.5s ease forwards;
      }
      
      .table tbody tr:nth-child(odd) {
        animation-delay: 0.05s;
      }
      
      .table tbody tr:nth-child(even) {
        animation-delay: 0.1s;
      }
      
      /* Badge styling */
      .badge {
        border-radius: 6px;
        padding: 0.4em 0.6em;
        font-weight: 500;
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-graduation-cap me-2"></i>វិទ្យាល័យកំរៀង
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="index.html"><i class="fas fa-home me-1"></i> Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="id-card.html"><i class="fas fa-id-card me-1"></i> ID Card</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="admin.html"><i class="fas fa-user-shield me-1"></i> Admin</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Student List Section -->
    <section class="py-5">
      <div class="container">
        <h2 class="section-title text-center">បញ្ជីឈ្មោះសិស្សនៃវិទ្យាល័យកំរៀង</h2>
        <p class="text-center mb-5 text-muted">
          នេះជាបញ្ជីឈ្មោះសិស្សដែលបានចុះឈ្មោះសម្រាប់ឆ្នាំសិក្សា ២០២៥-២០២៦ អ្នកអាចស្វែងរក ឬតម្រៀបតាមថ្នាក់ដើម្បីរកមើលព័ត៌មានបន្ថែម។
        </p>

        <!-- Statistics Section -->
        <div class="stats-container">
          <h4 class="mb-4 text-center text-primary">ស្ថិតិសិស្ស</h4>
          <div class="row">
            <div class="col-md-3 mb-3">
              <div class="stat-card total">
                <div class="stat-number" id="totalStudents">0</div>
                <div class="stat-label">សិស្សសរុប</div>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="stat-card grade">
                <div class="stat-number" id="grade7Count">0</div>
                <div class="stat-label">ថ្នាក់ទី ៧</div>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="stat-card grade">
                <div class="stat-number" id="grade8Count">0</div>
                <div class="stat-label">ថ្នាក់ទី ៨</div>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="stat-card grade">
                <div class="stat-number" id="grade9Count">0</div>
                <div class="stat-label">ថ្នាក់ទី ៩</div>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="stat-card grade">
                <div class="stat-number" id="grade10Count">0</div>
                <div class="stat-label">ថ្នាក់ទី ១០</div>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="stat-card grade">
                <div class="stat-number" id="grade11Count">0</div>
                <div class="stat-label">ថ្នាក់ទី ១១</div>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="stat-card grade">
                <div class="stat-number" id="grade12Count">0</div>
                <div class="stat-label">ថ្នាក់ទី ១២</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Search and Filter Section -->
        <div class="search-filter-section">
          <div class="row">
            <div class="col-md-6">
              <div class="input-group mb-3">
                <input
                  type="text"
                  class="form-control"
                  placeholder="ស្វែងរកតាមឈ្មោះ ឬលេខសម្គាល់..."
                  id="searchInput"
                />
                <button class="btn btn-primary" type="button" id="searchButton">
                  <i class="fas fa-search me-1"></i>ស្វែងរក
                </button>
              </div>
            </div>
            <div class="col-md-6">
              <div class="input-group mb-3">
                <select class="form-select" id="classFilter">
                  <option value="">ថ្នាក់ទាំងអស់</option>
                  <option value="7">ថ្នាក់ទី ៧</option>
                  <option value="8">ថ្នាក់ទី ៨</option>
                  <option value="9">ថ្នាក់ទី ៩</option>
                  <option value="10">ថ្នាក់ទី ១០</option>
                  <option value="11">ថ្នាក់ទី ១១</option>
                  <option value="12">ថ្នាក់ទី ១២</option>
                </select>
                <button
                  class="btn btn-outline-primary"
                  type="button"
                  id="filterButton"
                >
                  <i class="fas fa-filter me-1"></i>តម្រៀប
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Progress Bar for Loading -->
        <div class="progress-container" id="progressContainer" style="display: none;">
          <div class="d-flex justify-content-between mb-2">
            <span>កំពុងទាញយកទិន្នន័យសិស្ស...</span>
            <span id="progressPercent">0%</span>
          </div>
          <div class="progress" style="height: 20px;">
            <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" 
                 role="progressbar" style="width: 0%;" 
                 aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
            </div>
          </div>
          <div class="text-center mt-2" id="progressStatus">ទាញយកទិន្នន័យ...</div>
        </div>

        <!-- Student Table Section -->
        <div class="section-card p-0">
          <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
              <thead>
                <tr>
                  <th>រូបភាព</th>
                  <th>លេខសម្គាល់</th>
                  <th>ឈ្មោះ</th>
                  <th>ថ្នាក់</th>
                  <th>ភេទ</th>
                  <th>សកម្មភាព</th>
                </tr>
              </thead>
              <tbody id="studentTableBody">
                <!-- Student data will be populated here -->
                <tr>
                  <td colspan="6" class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2 text-muted">កំពុងទាញយកទិន្នន័យ...</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Pagination -->
        <div class="pagination-container">
          <nav aria-label="Page navigation">
            <ul class="pagination" id="pagination">
              <!-- Pagination will be generated here -->
            </ul>
          </nav>
        </div>
        
        <div class="pagination-info" id="paginationInfo">
          <!-- Pagination info will be shown here -->
        </div>

        <div class="text-center mt-4">
          <a href="report.html" class="btn btn-success">
            <i class="fas fa-file-excel me-2"></i>Export to Excel
          </a>
        </div>
      </div>
    </section>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header modal-danger-header">
            <h5 class="modal-title" id="deleteModalLabel">
              <i class="fas fa-exclamation-triangle me-2"></i>លុបសិស្ស
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="text-center mb-3">
              <i class="fas fa-user-times text-danger" style="font-size: 3rem;"></i>
            </div>
            <p class="text-center">
              តើអ្នកពិតជាចង់លុបសិស្ស <strong id="studentNameToDelete"></strong> (ID: <strong id="studentIdToDelete"></strong>) មែនទេ?
            </p>
            <div class="alert alert-warning">
              <i class="fas fa-exclamation-triangle me-2"></i>
              <strong>ព្រមាន:</strong> សកម្មភាពនេះមិនអាចត្រលប់បានទេ! ទិន្នន័យទាំងអស់របស់សិស្សនេះនឹងត្រូវបានលុបចោលជាអចិន្ត្រៃយ៍។
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              <i class="fas fa-times me-1"></i>បោះបង់
            </button>
            <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
              <i class="fas fa-trash me-1"></i>លុបសិស្ស
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Update Student Modal -->
    <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header modal-update-header">
            <h5 class="modal-title" id="updateModalLabel">
              <i class="fas fa-edit me-2"></i>កែសម្រួលព័ត៌មានសិស្ស
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="updateStudentForm">
              <div class="row">
                <div class="col-md-6">
                  <div class="update-form-group">
                    <label for="updateStudentId" class="form-label">លេខសម្គាល់សិស្ស</label>
                    <input type="text" class="form-control update-form-control" id="updateStudentId" readonly>
                  </div>
                  <div class="update-form-group">
                    <label for="updateStudentName" class="form-label">ឈ្មោះ</label>
                    <input type="text" class="form-control update-form-control" id="updateStudentName" required>
                  </div>
                  <div class="update-form-group">
                    <label for="updateStudentClass" class="form-label">ថ្នាក់</label>
                    <input type="text" class="form-control update-form-control" id="updateStudentClass" required placeholder="ឧទាហរណ៍: Grade 10A, Grade 11B">
                  </div>
                  <div class="update-form-group">
                    <label for="updateStudentGender" class="form-label">ភេទ</label>
                    <select class="form-select update-form-control" id="updateStudentGender" required>
                      <option value="">ជ្រើសរើសភេទ</option>
                      <option value="Male">ប្រុស</option>
                      <option value="Female">ស្រី</option>
                    </select>
                  </div>
                  <div class="update-form-group">
                    <label for="updateStudentDob" class="form-label">ថ្ងៃខែឆ្នាំកំណើត</label>
                    <input type="date" class="form-control update-form-control" id="updateStudentDob">
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="update-form-group">
                    <label for="updateStudentAddress" class="form-label">អាសយដ្ឋាន</label>
                    <textarea class="form-control update-form-control" id="updateStudentAddress" rows="3"></textarea>
                  </div>
                  <div class="update-form-group">
                    <label for="updateStudentPhone" class="form-label">លេខទូរស័ព្ទ</label>
                    <input type="text" class="form-control update-form-control" id="updateStudentPhone">
                  </div>
                  <div class="update-form-group">
                    <label for="updateStudentFather" class="form-label">ឈ្មោះឪពុក</label>
                    <input type="text" class="form-control update-form-control" id="updateStudentFather">
                  </div>
                  <div class="update-form-group">
                    <label for="updateStudentMother" class="form-label">ឈ្មោះម្តាយ</label>
                    <input type="text" class="form-control update-form-control" id="updateStudentMother">
                  </div>
                  <div class="update-form-group">
                    <label for="updateStudentStudyYear" class="form-label">ឆ្នាំសិក្សា</label>
                    <input type="text" class="form-control update-form-control" id="updateStudentStudyYear">
                  </div>
                  <div class="update-form-group">
                    <label for="updateStudentPhoto" class="form-label">URL រូបភាព</label>
                    <input type="text" class="form-control update-form-control" id="updateStudentPhoto">
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              <i class="fas fa-times me-1"></i>បោះបង់
            </button>
            <button type="button" class="btn btn-update" id="confirmUpdateBtn">
              <i class="fas fa-save me-1"></i>រក្សាទុក
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-md-4 mb-4 mb-md-0">
            <h5>វិទ្យាល័យកំរៀង</h5>
            <p>ស្ថិតនៅ ភូមិអូរដា ឃុំបឹងរាំង ស្រុកកំរៀង ខេត្តបាត់ដំបង</p>
          </div>
          <div class="col-md-4 mb-4 mb-md-0">
            <h5>ព័ត៌មានលម្អិត</h5>
            <p>
              <i class="fas fa-map-marker-alt me-2"></i> ស្រុកកំរៀង, ខេត្តបាត់ដំបង
            </p>
            <p><i class="fas fa-phone me-2"></i> +885969982589</p>
            <p><i class="fas fa-envelope me-2"></i> kr@highschool.edu</p>
          </div>
          <div class="col-md-4">
            <h5>Menu</h5>
            <ul class="list-unstyled">
              <li><a href="index.html" class="text-white">Home</a></li>
              <li>
                <a href="student-list.html" class="text-white">Student List</a>
              </li>
              <li><a href="id-card.html" class="text-white">ID Card</a></li>
              <li><a href="admin.html" class="text-white">Admin</a></li>
            </ul>
          </div>
        </div>
        <hr class="my-4 bg-light" />
        <div class="text-center">
          <p>&copy; ឆ្នាំសិក្សា ២០២៥៌-២០២៦</p>
        </div>
      </div>
    </footer>

    <!-- Bootstrap JS and dependencies -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
      crossorigin="anonymous"
    ></script>
    
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
      // Initialize Supabase client
      const supabaseUrl = 'https://ovvlshbuayykddqrnoqx.supabase.co';
      const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92dmxzaGJ1YXl5a2RkcXJub3F4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3NjQxODgsImV4cCI6MjA3NjM0MDE4OH0.vWLDFMS16PwZga9mYehVUiL6G0ccnRzdc9OUf2OM76I';
      const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
      
      // Global variables
      let allStudents = [];
      let currentUpdateStudentId = null;
      let currentDeleteStudentId = null;
      let currentDeleteStudentName = null;
      
      // Pagination settings
      const studentsPerPage = 100;
      let currentPage = 1;
      let totalPages = 1;
      
      // Function to fetch all students with pagination
      async function getAllStudents() {
        try {
          // Show progress bar
          document.getElementById('progressContainer').style.display = 'block';
          document.getElementById('progressBar').style.width = '0%';
          document.getElementById('progressPercent').textContent = '0%';
          document.getElementById('progressStatus').textContent = 'ទាញយកទិន្នន័យ...';
          
          let allData = [];
          let page = 0;
          const pageSize = 1000; // Supabase max limit
          let hasMore = true;
          
          while (hasMore) {
            const from = page * pageSize;
            const to = from + pageSize - 1;
            
            const { data, error, count } = await supabase
              .from('students')
              .select('*', { count: 'exact' })
              .order('id', { ascending: true })
              .range(from, to);
            
            if (error) {
              console.error('Error fetching students:', error);
              throw error;
            }
            
            if (data && data.length > 0) {
              allData = [...allData, ...data];
              
              // Update progress
              const progress = Math.min(100, Math.round((allData.length / (count || allData.length + pageSize)) * 100));
              document.getElementById('progressBar').style.width = `${progress}%`;
              document.getElementById('progressPercent').textContent = `${progress}%`;
              document.getElementById('progressStatus').textContent = `ទាញយកបាន ${allData.length} នាក់...`;
              
              // If we got less than the page size, we've reached the end
              if (data.length < pageSize) {
                hasMore = false;
              } else {
                page++;
              }
            } else {
              hasMore = false;
            }
          }
          
          // Hide progress bar when done
          document.getElementById('progressContainer').style.display = 'none';
          
          console.log(`Fetched ${allData.length} students total`);
          return allData;
        } catch (error) {
          console.error('Error in getAllStudents:', error);
          document.getElementById('progressContainer').style.display = 'none';
          return [];
        }
      }
      
      // Alternative method using multiple requests with estimated total
      async function getAllStudentsAlternative() {
        try {
          // First, get the total count
          const { count, error: countError } = await supabase
            .from('students')
            .select('*', { count: 'exact', head: true });
          
          if (countError) {
            console.error('Error counting students:', countError);
          }
          
          const estimatedTotal = count || 2000; // Use actual count or estimate
          console.log(`Estimated total students: ${estimatedTotal}`);
          
          // Show progress bar
          document.getElementById('progressContainer').style.display = 'block';
          document.getElementById('progressBar').style.width = '0%';
          document.getElementById('progressPercent').textContent = '0%';
          
          let allData = [];
          const pageSize = 1000;
          const totalPages = Math.ceil(estimatedTotal / pageSize);
          
          for (let page = 0; page < totalPages; page++) {
            const from = page * pageSize;
            const to = from + pageSize - 1;
            
            const { data, error } = await supabase
              .from('students')
              .select('*')
              .order('id', { ascending: true })
              .range(from, to);
            
            if (error) {
              console.error(`Error fetching page ${page}:`, error);
              continue;
            }
            
            if (data && data.length > 0) {
              allData = [...allData, ...data];
              
              // Update progress
              const progress = Math.min(100, Math.round(((page + 1) / totalPages) * 100));
              document.getElementById('progressBar').style.width = `${progress}%`;
              document.getElementById('progressPercent').textContent = `${progress}%`;
              document.getElementById('progressStatus').textContent = `ទាញយកបាន ${allData.length} នាក់...`;
            }
            
            // Small delay to avoid rate limiting
            await new Promise(resolve => setTimeout(resolve, 100));
          }
          
          // Hide progress bar when done
          document.getElementById('progressContainer').style.display = 'none';
          
          console.log(`Fetched ${allData.length} students total`);
          return allData;
        } catch (error) {
          console.error('Error in getAllStudentsAlternative:', error);
          document.getElementById('progressContainer').style.display = 'none';
          return [];
        }
      }
      
      // Calculate and display statistics
      function updateStatistics(students) {
        // Total students
        document.getElementById('totalStudents').textContent = students.length;
        
        // Count students by grade
        const grade7Count = students.filter(student => student.class && student.class.includes('7')).length;
        const grade8Count = students.filter(student => student.class && student.class.includes('8')).length;
        const grade9Count = students.filter(student => student.class && student.class.includes('9')).length;
        const grade10Count = students.filter(student => student.class && student.class.includes('10')).length;
        const grade11Count = students.filter(student => student.class && student.class.includes('11')).length;
        const grade12Count = students.filter(student => student.class && student.class.includes('12')).length;
        
        // Update the DOM
        document.getElementById('grade7Count').textContent = grade7Count;
        document.getElementById('grade8Count').textContent = grade8Count;
        document.getElementById('grade9Count').textContent = grade9Count;
        document.getElementById('grade10Count').textContent = grade10Count;
        document.getElementById('grade11Count').textContent = grade11Count;
        document.getElementById('grade12Count').textContent = grade12Count;
      }
      
      // Filter students based on search and class filter
      function filterStudents() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const classFilter = document.getElementById('classFilter').value;
        
        let filteredStudents = allStudents;
        
        // Apply search filter
        if (searchTerm) {
          filteredStudents = filteredStudents.filter(student => 
            (student.name && student.name.toLowerCase().includes(searchTerm)) || 
            (student.id && student.id.toLowerCase().includes(searchTerm))
          );
        }
        
        // Apply class filter
        if (classFilter) {
          filteredStudents = filteredStudents.filter(student => 
            student.class && student.class.includes(classFilter)
          );
        }
        
        return filteredStudents;
      }
      
      // Get students for current page
      function getStudentsForCurrentPage(filteredStudents) {
        const startIndex = (currentPage - 1) * studentsPerPage;
        const endIndex = startIndex + studentsPerPage;
        return filteredStudents.slice(startIndex, endIndex);
      }
      
      // Update pagination
      function updatePagination(filteredStudents) {
        totalPages = Math.ceil(filteredStudents.length / studentsPerPage);
        const paginationElement = document.getElementById('pagination');
        const paginationInfoElement = document.getElementById('paginationInfo');
        
        // Update pagination info
        const startIndex = (currentPage - 1) * studentsPerPage + 1;
        const endIndex = Math.min(currentPage * studentsPerPage, filteredStudents.length);
        paginationInfoElement.textContent = `បង្ហាញសិស្ស ${startIndex} ដល់ ${endIndex} ក្នុងចំណោម ${filteredStudents.length} នាក់`;
        
        // Clear existing pagination
        paginationElement.innerHTML = '';
        
        // Previous button
        const prevLi = document.createElement('li');
        prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
        prevLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage - 1}">Previous</a>`;
        paginationElement.appendChild(prevLi);
        
        // Page numbers (show max 5 pages around current page)
        const startPage = Math.max(1, currentPage - 2);
        const endPage = Math.min(totalPages, startPage + 4);
        
        for (let i = startPage; i <= endPage; i++) {
          const pageLi = document.createElement('li');
          pageLi.className = `page-item ${i === currentPage ? 'active' : ''}`;
          pageLi.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
          paginationElement.appendChild(pageLi);
        }
        
        // Next button
        const nextLi = document.createElement('li');
        nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
        nextLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage + 1}">Next</a>`;
        paginationElement.appendChild(nextLi);
        
        // Add event listeners to pagination buttons
        document.querySelectorAll('.page-link').forEach(link => {
          link.addEventListener('click', function(e) {
            e.preventDefault();
            const page = parseInt(this.getAttribute('data-page'));
            if (page && page !== currentPage && page >= 1 && page <= totalPages) {
              currentPage = page;
              populateStudentTable();
            }
          });
        });
      }
      
      // Render student table
      async function populateStudentTable() {
        const tableBody = document.getElementById("studentTableBody");
        
        // Show loading state only on initial load
        if (allStudents.length === 0) {
          tableBody.innerHTML = `
            <tr>
              <td colspan="6" class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2 text-muted">កំពុងទាញយកទិន្នន័យ...</p>
              </td>
            </tr>
          `;
          
          // Load all students from Supabase
          allStudents = await getAllStudentsAlternative();
        }
        
        const filteredStudents = filterStudents();
        const studentsForPage = getStudentsForCurrentPage(filteredStudents);
        
        // Update statistics with all students
        updateStatistics(allStudents);
        
        // Update pagination
        updatePagination(filteredStudents);
        
        // Clear table
        tableBody.innerHTML = "";

        if (studentsForPage.length === 0) {
          tableBody.innerHTML = `<tr><td colspan="6" class="text-center py-4 text-muted">មិនមានទិន្នន័យសិស្សត្រូវបានរកឃើញទេ។</td></tr>`;
          return;
        }

        studentsForPage.forEach((student) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                <td><img src="${student.photo || 'https://via.placeholder.com/50'}" alt="${student.name}" class="student-photo"></td>
                <td>${student.id || 'N/A'}</td>
                <td>${student.name || 'N/A'}</td>
                <td><span class="badge bg-primary">${student.class || 'N/A'}</span></td>
                <td>${student.gender || 'N/A'}</td>
                <td class="action-buttons">
                    <button class="btn btn-sm btn-info view-student" data-id="${student.id}">
                        <i class="fas fa-eye"></i> View
                    </button>
                    <button class="btn btn-sm btn-update update-student" data-id="${student.id}">
                        <i class="fas fa-edit"></i> Update
                    </button>
                    <button class="btn btn-sm btn-danger delete-student" data-id="${student.id}" data-name="${student.name}">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </td>
            `;
          tableBody.appendChild(row);
        });

        // Add event listeners for view buttons
        document.querySelectorAll(".view-student").forEach((button) => {
          button.addEventListener("click", function () {
            const studentId = this.getAttribute("data-id");
            viewStudentDetails(studentId);
          });
        });

        // Add event listeners for update buttons
        document.querySelectorAll(".update-student").forEach((button) => {
          button.addEventListener("click", function () {
            const studentId = this.getAttribute("data-id");
            updateStudent(studentId);
          });
        });

        // Add event listeners for delete buttons
        document.querySelectorAll(".delete-student").forEach((button) => {
          button.addEventListener("click", function () {
            const studentId = this.getAttribute("data-id");
            const studentName = this.getAttribute("data-name");
            deleteStudent(studentId, studentName);
          });
        });
      }
      
      // View student details (redirect to a view page or show modal)
      function viewStudentDetails(studentId) {
        window.location.href = `digital-card.html?id=${studentId}`;
      }
      
      // Update student function
      function updateStudent(studentId) {
        const student = allStudents.find(s => s.id === studentId);
        
        if (!student) {
          alert('សិស្សមិនត្រូវបានរកឃើញ!');
          return;
        }
        
        currentUpdateStudentId = studentId;
        
        // Fill form with current student data
        document.getElementById('updateStudentId').value = student.id || '';
        document.getElementById('updateStudentName').value = student.name || '';
        document.getElementById('updateStudentClass').value = student.class || '';
        document.getElementById('updateStudentGender').value = student.gender || '';
        document.getElementById('updateStudentPhoto').value = student.photo || '';
        document.getElementById('updateStudentAddress').value = student.address || '';
        document.getElementById('updateStudentPhone').value = student.phone || '';
        document.getElementById('updateStudentFather').value = student.father || '';
        document.getElementById('updateStudentMother').value = student.mother || '';
        document.getElementById('updateStudentStudyYear').value = student.studyYear || '';
        document.getElementById('updateStudentDob').value = student.dob || '';
        
        // Show modal
        const updateModal = new bootstrap.Modal(document.getElementById('updateModal'));
        updateModal.show();
      }
      
      // Confirm update function
      async function confirmUpdate() {
        if (!currentUpdateStudentId) {
          return;
        }
        
        try {
          // Get updated values from form
          const updatedData = {
            name: document.getElementById('updateStudentName').value,
            class: document.getElementById('updateStudentClass').value,
            gender: document.getElementById('updateStudentGender').value,
            photo: document.getElementById('updateStudentPhoto').value || null,
            address: document.getElementById('updateStudentAddress').value || null,
            phone: document.getElementById('updateStudentPhone').value || null,
            father: document.getElementById('updateStudentFather').value || null,
            mother: document.getElementById('updateStudentMother').value || null,
            studyYear: document.getElementById('updateStudentStudyYear').value || null,
            dob: document.getElementById('updateStudentDob').value || null
          };
          
          // Validate required fields
          if (!updatedData.name || !updatedData.class || !updatedData.gender) {
            alert('សូមបំពេញព័ត៌មានដែលត្រូវការទាំងអស់!');
            return;
          }
          
          // Show loading state on confirm button
          const confirmBtn = document.getElementById('confirmUpdateBtn');
          const originalText = confirmBtn.innerHTML;
          confirmBtn.disabled = true;
          confirmBtn.innerHTML = '<div class="loading-spinner"></div> កំពុងរក្សាទុក...';
          
          // Update in Supabase
          const { error } = await supabase
            .from('students')
            .update(updatedData)
            .eq('id', currentUpdateStudentId);
          
          if (error) {
            throw error;
          }
          
          // Hide modal
          const updateModal = bootstrap.Modal.getInstance(document.getElementById('updateModal'));
          updateModal.hide();
          
          // Show success message
          alert(`ព័ត៌មានសិស្សត្រូវបានកែសម្រួលដោយជោគជ័យ!`);
          
          // Refresh the table
          await populateStudentTable();
          
        } catch (error) {
          console.error('Error updating student:', error);
          
          // Reset button state
          const confirmBtn = document.getElementById('confirmUpdateBtn');
          confirmBtn.disabled = false;
          confirmBtn.innerHTML = '<i class="fas fa-save me-1"></i>រក្សាទុក';
          
          // Show error message
          let errorMessage = `កំហុសក្នុងការកែសម្រួលព័ត៌មាន: ${error.message}`;
          
          if (error.message.includes('permission')) {
            errorMessage = 'កំហុស: មិនមានសិទ្ធិកែសម្រួលទិន្នន័យ';
          } else if (error.message.includes('network') || error.message.includes('fetch')) {
            errorMessage = 'កំហុស: បញ្ហាការតភ្ជាប់អ៊ីនធឺណិត';
          }
          
          alert(errorMessage);
        } finally {
          // Reset global variable
          currentUpdateStudentId = null;
        }
      }
      
      // Delete student function
      function deleteStudent(studentId, studentName) {
        currentDeleteStudentId = studentId;
        currentDeleteStudentName = studentName;
        
        // Update modal content
        document.getElementById('studentNameToDelete').textContent = studentName;
        document.getElementById('studentIdToDelete').textContent = studentId;
        
        // Show modal
        const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
        deleteModal.show();
      }
      
      // Confirm delete function
      async function confirmDelete() {
        if (!currentDeleteStudentId || !currentDeleteStudentName) {
          return;
        }
        
        try {
          // Show loading state on confirm button
          const confirmBtn = document.getElementById('confirmDeleteBtn');
          const originalText = confirmBtn.innerHTML;
          confirmBtn.disabled = true;
          confirmBtn.innerHTML = '<div class="loading-spinner"></div> កំពុងលុប...';
          
          // Delete from Supabase
          const { error } = await supabase
            .from('students')
            .delete()
            .eq('id', currentDeleteStudentId);
          
          if (error) {
            throw error;
          }
          
          // Hide modal
          const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
          deleteModal.hide();
          
          // Show success message
          alert(`សិស្ស "${currentDeleteStudentName}" ត្រូវបានលុបដោយជោគជ័យ!`);
          
          // Refresh the table
          await populateStudentTable();
          
        } catch (error) {
          console.error('Error deleting student:', error);
          
          // Reset button state
          const confirmBtn = document.getElementById('confirmDeleteBtn');
          confirmBtn.disabled = false;
          confirmBtn.innerHTML = '<i class="fas fa-trash me-1"></i>លុបសិស្ស';
          
          // Show error message
          let errorMessage = `កំហុសក្នុងការលុបសិស្ស: ${error.message}`;
          
          if (error.message.includes('permission')) {
            errorMessage = 'កំហុស: មិនមានសិទ្ធិលុបទិន្នន័យ';
          } else if (error.message.includes('network') || error.message.includes('fetch')) {
            errorMessage = 'កំហុស: បញ្ហាការតភ្ជាប់អ៊ីនធឺណិត';
          }
          
          alert(errorMessage);
        } finally {
          // Reset global variables
          currentDeleteStudentId = null;
          currentDeleteStudentName = null;
        }
      }
      
      // Event listeners for search and filter
      document.getElementById('searchButton').addEventListener('click', function() {
        currentPage = 1; // Reset to first page when searching
        populateStudentTable();
      });
      
      document.getElementById('filterButton').addEventListener('click', function() {
        currentPage = 1; // Reset to first page when filtering
        populateStudentTable();
      });
      
      // Search on Enter key press
      document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          currentPage = 1; // Reset to first page when searching
          populateStudentTable();
        }
      });
      
      // Event listener for confirm update button
      document.getElementById('confirmUpdateBtn').addEventListener('click', confirmUpdate);
      
      // Event listener for confirm delete button
      document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);
      
      // Initial population
      document.addEventListener("DOMContentLoaded", populateStudentTable);
    </script>
  </body>
</html>
