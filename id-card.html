<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ID Card - High School</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        /* ... your styles unchanged ... */
    </style>
</head>
<body>
    <!-- Navigation and main content unchanged ... -->

    <!-- Load students.js before your main JS -->
    <script src="students.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        function showError(msg) {
            alert(msg);
        }

        function fillIdCard(student) {
            document.getElementById('idCardContainer').classList.remove('d-none');
            document.getElementById('idCardPhoto').src = student.photo || '';
            document.getElementById('idCardId').textContent = student.id || '';
            document.getElementById('idCardName').textContent = student.name || '';
            document.getElementById('idCardClass').textContent = student.class || '';
            document.getElementById('idCardValid').textContent = student.studyYear || '';
            document.getElementById('fullStudentInfo').innerHTML = `
                <div class="col-md-6">
                    <p><strong>Gender:</strong> ${student.gender || ''}</p>
                    <p><strong>Date of Birth:</strong> ${student.dob || ''}</p>
                    <p><strong>Address:</strong> ${student.address || ''}</p>
                    <p><strong>Phone:</strong> ${student.phone || ''}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Father:</strong> ${student.father || ''}</p>
                    <p><strong>Mother:</strong> ${student.mother || ''}</p>
                    <p><strong>Study Year:</strong> ${student.studyYear || ''}</p>
                </div>
            `;
            // Generate QR code
            if (window.QRCode) {
                document.getElementById('qrcode').innerHTML = '';
                new QRCode(document.getElementById('qrcode'), {
                    text: JSON.stringify(student),
                    width: 128,
                    height: 128
                });
            }
        }

        document.getElementById('generateIdCard').addEventListener('click', function() {
            const studentId = document.getElementById('studentIdInput').value.trim();
            if (!studentId) {
                showError('សូមបញ្ចូលលេខសម្គាល់សិស្ស (ID)');
                return;
            }
            if (typeof students === "undefined" || !Array.isArray(students)) {
                showError("students.js មិនត្រូវបានបញ្ចូលឬ students array មិនមាន!");
                return;
            }
            const student = students.find((s) => String(s.id) === studentId);
            if (!student) {
                showError('រកមិនឃើញសិស្សនេះទេ!');
                document.getElementById('idCardContainer').classList.add('d-none');
                return;
            }
            fillIdCard(student);
        });

        document.getElementById('printIdCard').addEventListener('click', function () {
            window.print();
        });
    });
    </script>
</body>
</html>
