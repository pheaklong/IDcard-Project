<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ášá”á¶á™á€á¶ášááŸáŸáŸ’á€áŸá“áŸá·áŸáŸ’áŸ</title>
    <script>
        // Check login: if not logged in, redirect to login page
        if (localStorage.getItem('adminLoggedIn') !== 'true') {
            window.location.href = 'login.html';
        }
    </script>
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Chart.js for statistics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SheetJS for Excel export -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --success: #4cc9f0;
            --success-dark: #2fb5e0;
            --warning: #f72585;
            --danger: #f94144;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --border-radius: 16px;
            --shadow: 0 8px 24px rgba(0,0,0,0.12);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Khmer OS', 'Noto Sans Khmer', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px 25px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .back-buttons {
            display: flex;
            gap: 12px;
            padding: 18px 25px;
            background: var(--light);
            border-bottom: 1px solid #e9ecef;
        }

        .content {
            padding: 30px 25px;
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid #e9ecef;
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Report Type Selection */
        .report-type-selection {
            margin-bottom: 25px;
        }

        .report-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
        }

        .report-type-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .report-type-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }

        .report-type-card.selected {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }

        .report-type-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .report-type-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
        }

        .report-type-desc {
            font-size: 0.9rem;
            color: var(--gray);
            line-height: 1.4;
        }

        /* Filter Section */
        .filter-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius);
            font-size: 14px;
            transition: var(--transition);
            font-family: 'Khmer OS', 'Noto Sans Khmer', 'Arial', sans-serif;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
        }

        /* Stats Section */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 18px;
            margin: 25px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.2);
        }

        .stat-number {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Chart Container */
        .chart-container {
            height: 300px;
            margin: 25px 0;
            position: relative;
        }

        /* Button Styles */
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-decoration: none;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-primary { 
            background: var(--primary);
            color: white; 
        }
        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
        }

        .btn-success { 
            background: var(--success);
            color: white; 
        }
        .btn-success:hover:not(:disabled) {
            background: var(--success-dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(76, 201, 240, 0.3);
        }

        .btn-warning { 
            background: var(--warning);
            color: white; 
        }
        .btn-warning:hover:not(:disabled) {
            background: #e51775;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(247, 37, 133, 0.3);
        }

        .btn-info { 
            background: var(--secondary);
            color: white; 
        }
        .btn-info:hover:not(:disabled) {
            background: #65199e;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(114, 9, 183, 0.3);
        }

        .btn-danger { 
            background: var(--danger);
            color: white; 
        }
        .btn-danger:hover:not(:disabled) {
            background: #d32f2f;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(249, 65, 68, 0.3);
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            margin: 25px 0;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

                    .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            table-layout: auto; /* á¢á“á»á‰áŸ’á‰á¶áá¢áŸ„á™áá¶ášá¶á„á˜á¶á“á‘á˜áŸ’ášá„áŸ‹áŠáŸ„á™áŸáŸ’áœáŸá™á”áŸ’ášáœááŸ’áá· */
        }

        .data-table th {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap; /* á˜á·á“á¢áŸ„á™á¢á€áŸ’áŸášá’áŸ’á›á¶á€áŸ‹á…á»áŸ‡á€áŸ’ášáŸ„á˜ */
            overflow: visible; /* á˜á·á“á›á¶á€áŸ‹á¢ááŸ’áá”á‘ */
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9rem;
            white-space: nowrap; /* á˜á·á“á¢áŸ„á™á¢á€áŸ’áŸášá’áŸ’á›á¶á€áŸ‹á…á»áŸ‡á€áŸ’ášáŸ„á˜ */
            overflow: visible; /* á˜á·á“á›á¶á€áŸ‹á¢ááŸ’áá”á‘ */
            line-height: 1.4;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* á’á¶á“á¶áá¶áá¶ášá¶á„á˜á¶á“á‘á˜áŸ’ášá„áŸ‹á›áŸ’á¢á“áŸ…á–áŸá›á˜á¶á“á‘á·á“áŸ’á“á“áŸá™á…áŸ’ášá¾á“ */
        .table-container {
            overflow-x: auto; /* á¢á“á»á‰áŸ’á‰á¶áá¢áŸ„á™ášáŸ†á€á·á›á•áŸ’áŠáŸá€á“áŸ…á–áŸá›ááŸ’ášá¼áœá€á¶áš */
            margin: 25px 0;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: block;
            white-space: nowrap; /* á˜á·á“á¢áŸ„á™áá¶ášá¶á„á’áŸ’á›á¶á€áŸ‹á…á»áŸ‡á€áŸ’ášáŸ„á˜ */
        }

        /* á€áŸ†áááŸ‹á‘á‘á¹á„á¢á”áŸ’á”á”ášá˜á¶áŸá˜áŸ’ášá¶á”áŸ‹á‡á½ášáˆášá“á¸á˜á½á™áŸ— */
        .data-table th:nth-child(1),
        .data-table td:nth-child(1) {
            min-width: 60px; /* á›.áš */
            max-width: 60px;
        }

        .data-table th:nth-child(2),
        .data-table td:nth-child(2) {
            min-width: 200px; /* áˆáŸ’á˜áŸ„áŸ‡áŸá·áŸáŸ’áŸ */
            max-width: 200px;
        }

        .data-table th:nth-child(3),
        .data-table td:nth-child(3) {
            min-width: 120px; /* ááŸ’á“á¶á€áŸ‹ */
            max-width: 120px;
        }

        .data-table th:nth-child(4),
        .data-table td:nth-child(4) {
            min-width: 100px; /* á—áŸá‘ */
            max-width: 100px;
        }

        .data-table th:nth-child(5),
        .data-table td:nth-child(5) {
            min-width: 120px; /* á–áŸá›áœáŸá›á¶ */
            max-width: 120px;
        }

        .data-table th:nth-child(6),
        .data-table td:nth-child(6) {
            min-width: 150px; /* á€á¶á›á”ášá·á…áŸ’á†áŸá‘ */
            max-width: 150px;
        }

        .data-table th:nth-child(7),
        .data-table td:nth-child(7) {
            min-width: 150px; /* á”áŸ’ášá—áŸá‘ */
            max-width: 150px;
        }

        /* á’á¶á“á¶áá¶á¢ááŸ’áá”á‘á˜á·á“á’áŸ’á›á¶á€áŸ‹á…á»áŸ‡á€áŸ’ášáŸ„á˜á“áŸ…á€áŸ’á“á»á„á€áŸ„áŸá·á€á¶ */
        .data-table td,
        .data-table th {
            text-overflow: clip; /* á˜á·á“á”áŸ’ášá¾ ellipsis */
        }

        /* á€á¶ášá€áŸ‚áŸá˜áŸ’ášá½á›áŸá˜áŸ’ášá¶á”áŸ‹á§á”á€ášááŸá…á›áŸá */
        @media (max-width: 768px) {
            .data-table th,
            .data-table td {
                font-size: 0.8rem;
                padding: 10px 8px;
                white-space: nowrap; /* á”á“áŸ’áá˜á·á“á¢áŸ„á™á’áŸ’á›á¶á€áŸ‹á…á»áŸ‡á€áŸ’ášáŸ„á˜á“áŸ…á›á¾á§á”á€ášááŸá…á›áŸá */
                overflow: visible;
            }
            
            /* á€á¶ááŸ‹á”á“áŸ’áá™á‘á‘á¹á„á¢á”áŸ’á”á”ášá˜á¶á“áŸ…á›á¾á§á”á€ášááŸá…á›áŸá */
            .data-table th:nth-child(1),
            .data-table td:nth-child(1) {
                min-width: 50px;
                max-width: 50px;
            }
            
            .data-table th:nth-child(2),
            .data-table td:nth-child(2) {
                min-width: 150px;
                max-width: 150px;
            }
            
            .data-table th:nth-child(3),
            .data-table td:nth-child(3) {
                min-width: 100px;
                max-width: 100px;
            }
            
            .data-table th:nth-child(4),
            .data-table td:nth-child(4) {
                min-width: 80px;
                max-width: 80px;
            }
            
            .data-table th:nth-child(5),
            .data-table td:nth-child(5) {
                min-width: 100px;
                max-width: 100px;
            }
            
            .data-table th:nth-child(6),
            .data-table td:nth-child(6) {
                min-width: 120px;
                max-width: 120px;
            }
            
            .data-table th:nth-child(7),
            .data-table td:nth-child(7) {
                min-width: 120px;
                max-width: 120px;
            }
            
            .table-container {
                overflow-x: auto; /* á¢á“á»á‰áŸ’á‰á¶áá¢áŸ„á™ášáŸ†á€á·á›á•áŸ’áŠáŸá€á“áŸ…á›á¾á§á”á€ášááŸá…á›áŸá */
                -webkit-overflow-scrolling: touch; /* á’áŸ’áœá¾á¢áŸ„á™ášá›á¼á“áŸá˜áŸ’ášá¶á”áŸ‹ touch devices */
            }
        }

        /* á’á¶á“á¶áá¶áá¶ášá¶á„á˜á¶á“á‘á˜áŸ’ášá„áŸ‹á›áŸ’á¢á“áŸ…á–áŸá›á”áŸ„áŸ‡á–á»á˜áŸ’á– */
        @media print {
            .data-table th,
            .data-table td {
                white-space: nowrap;
                overflow: visible;
            }
            
            .table-container {
                overflow-x: visible;
            }
        }

        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-align: center;
            display: inline-block;
        }

        .badge-late {
            background: #fff3cd;
            color: #856404;
        }

        .badge-discipline {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-helpful {
            background: #d1edff;
            color: #004085;
        }

        .badge-haircut {
            background: #d4edda;
            color: #155724;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: var(--gray);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .button-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .report-type-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.6rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .card-title {
                font-size: 1.2rem;
            }
            
            .btn {
                padding: 14px 18px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .content {
                padding: 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                padding: 25px 20px;
            }
            
            .back-buttons {
                flex-direction: column;
                gap: 10px;
            }
             
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ“Š ášá”á¶á™á€á¶ášááŸáŸáŸ’á€áŸá“áŸá·áŸáŸ’áŸ</h1>
            <p>á”áŸ’ášá–áŸá“áŸ’á’á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„ á“á·á„áœá·á—á¶á‚á‘á·á“áŸ’á“á“áŸá™áŸáŸ’á€áŸá“áŸá·áŸáŸ’áŸ</p>
        </div>
        
        <!-- Back Buttons -->
        <div class="back-buttons">
            <button class="btn btn-primary" onclick="goToHome()">
                ğŸ  ááŸ’ášá›á”áŸ‹á‘áŸ…á‘áŸ†á–áŸášáŠá¾á˜
            </button>
            <button class="btn btn-secondary" onclick="goToScanner()">
                ğŸ” á‘áŸ…á€á¶á“áŸ‹á‘áŸ†á–áŸášáŸáŸ’á€áŸá“
            </button>
        </div>
        
        <!-- Main Content -->
        <div class="content">
            <!-- Report Type Selection -->
            <div class="report-type-selection">
                <div class="card">
                    <h2 class="card-title">ğŸ“‹ á‡áŸ’ášá¾áŸášá¾áŸá”áŸ’ášá—áŸá‘ášá”á¶á™á€á¶ášááŸ</h2>
                    <div class="report-type-grid">
                        <div class="report-type-card" data-type="late" onclick="selectReportType('late')">
                            <div class="report-type-icon">â°</div>
                            <div class="report-type-title">áŸá·áŸáŸ’áŸá˜á€á™áºá</div>
                            <div class="report-type-desc">ášá”á¶á™á€á¶ášááŸáŸá·áŸáŸ’áŸáŠáŸ‚á›á˜á€á™áºá á˜á·á“á‚áŸ„ášá–á‘á„áŸ‹á‡á¶áá·</div>
                        </div>
                        <div class="report-type-card" data-type="discipline" onclick="selectReportType('discipline')">
                            <div class="report-type-icon">âš ï¸</div>
                            <div class="report-type-title">áŸá·áŸáŸ’áŸá˜á·á“á‚áŸ„ášá–áœá·á“áŸá™</div>
                            <div class="report-type-desc">ášá”á¶á™á€á¶ášááŸáŸá·áŸáŸ’áŸáŠáŸ‚á›á˜á·á“á‚áŸ„ášá–áœá·á“áŸá™áŸá¶á›á¶</div>
                        </div>
                        <div class="report-type-card" data-type="helpful" onclick="selectReportType('helpful')">
                            <div class="report-type-icon">ğŸ¤</div>
                            <div class="report-type-title">áŸá·áŸáŸ’áŸá‡á½á™á€á¶ášá„á¶áš</div>
                            <div class="report-type-desc">ášá”á¶á™á€á¶ášááŸáŸá·áŸáŸ’áŸáŠáŸ‚á›á”á¶á“á‡á½á™á€á¶ášá„á¶ášáŸá¶á›á¶</div>
                        </div>
                        <div class="report-type-card" data-type="haircut" onclick="selectReportType('haircut')">
                            <div class="report-type-icon">ğŸ’‡</div>
                            <div class="report-type-title">áŸá·áŸáŸ’áŸááŸ’ášá¼áœá€á¶ááŸ‹áŸá€áŸ‹</div>
                            <div class="report-type-desc">ášá”á¶á™á€á¶ášááŸáŸá·áŸáŸ’áŸáŠáŸ‚á›ááŸ’ášá¼áœá€á¶ááŸ‹áŸá€áŸ‹áá¶á˜áœá·á“áŸá™</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Current Report Type Display -->
            <div id="current-report-type" class="card" style="display: none;">
                <h2 class="card-title" id="current-report-title">ášá”á¶á™á€á¶ášááŸáŸá·áŸáŸ’áŸá˜á€á™áºá</h2>
                <p id="current-report-description">ášá”á¶á™á€á¶ášááŸáŸá·áŸáŸ’áŸáŠáŸ‚á›á˜á€á™áºá á˜á·á“á‚áŸ„ášá–á‘á„áŸ‹á‡á¶áá·</p>
            </div>

            <!-- Filter Section -->
            <div id="filter-section" class="filter-section" style="display: none;">
                <h3 style="margin-bottom: 20px; color: var(--primary);">ğŸ” ááŸ’ášá„á‘á·á“áŸ’á“á“áŸá™</h3>
                <div class="filter-grid">
                    <div class="form-group">
                        <label for="date-filter">á€á¶á›á”ášá·á…áŸ’á†áŸá‘</label>
                        <select id="date-filter" class="form-control" onchange="applyFilters()">
                            <option value="today">ááŸ’á„áŸƒá“áŸáŸ‡</option>
                            <option value="yesterday">á˜áŸ’áŸá·á›á˜á·á‰</option>
                            <option value="week">áŸá”áŸ’áá¶á áŸá“áŸáŸ‡</option>
                            <option value="month">ááŸ‚á“áŸáŸ‡</option>
                            <option value="custom">á€á¶á›á”ášá·á…áŸ’á†áŸá‘á‡á¶á€áŸ‹á›á¶á€áŸ‹</option>
                        </select>
                    </div>
                    <div class="form-group" id="custom-date-group" style="display: none;">
                        <label for="custom-date">á‡áŸ’ášá¾áŸášá¾áŸá€á¶á›á”ášá·á…áŸ’á†áŸá‘</label>
                        <input type="date" id="custom-date" class="form-control" onchange="applyFilters()">
                    </div>
                    <div class="form-group">
                        <label for="class-filter">ááŸ’á“á¶á€áŸ‹</label>
                        <select id="class-filter" class="form-control" onchange="applyFilters()">
                            <option value="all">á‘á¶áŸ†á„á¢áŸáŸ‹</option>
                            <!-- Class options will be populated dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="search-filter">áŸáŸ’áœáŸ‚á„ášá€</label>
                        <input type="text" id="search-filter" class="form-control" placeholder="áˆáŸ’á˜áŸ„áŸ‡ á¬á¢ááŸ’áá›áŸááŸá·áŸáŸ’áŸ..." onkeyup="applyFilters()">
                    </div>
                </div>
            </div>

            <!-- Stats Section -->
            <div id="stats-section" class="stats-grid" style="display: none;">
                <div class="stat-card">
                    <div class="stat-number" id="total-scans">0</div>
                    <div class="stat-label">áŸáŸ’á€áŸá“áŸášá»á”</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="today-scans">0</div>
                    <div class="stat-label">áŸáŸ’á€áŸá“ááŸ’á„áŸƒá“áŸáŸ‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="unique-students">0</div>
                    <div class="stat-label">áŸá·áŸáŸ’áŸá•áŸ’áŸáŸá„á‚áŸ’á“á¶</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="most-frequent">0</div>
                    <div class="stat-label">áŸáŸ’á€áŸá“á…áŸ’ášá¾á“á‡á¶á„á‚áŸ</div>
                </div>
            </div>

            <!-- Chart Section -->
            <div id="chart-section" style="display: none;">
                <div class="card">
                    <h2 class="card-title">ğŸ“ˆ áá¶ášá¶á„áŸáŸ’áá·áá·</h2>
                    <div class="chart-container">
                        <canvas id="reportChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Data Table -->
            <div id="table-section" style="display: none;">
                <div class="card">
                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px;">
                        <h2 class="card-title">ğŸ“‹ á‘á·á“áŸ’á“á“áŸá™áŸáŸ’á€áŸá“</h2>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-success" onclick="exportToExcel()">
                                ğŸ“Š Export to Excel
                            </button>
                            <button class="btn btn-primary" onclick="printReport()">
                                ğŸ–¨ï¸ Print
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table" id="report-table">
                            <thead>
                                <tr>
                                    <th>á›.áš</th>
                                    <th>áˆáŸ’á˜áŸ„áŸ‡áŸá·áŸáŸ’áŸ</th>
                                    <th>ááŸ’á“á¶á€áŸ‹</th>
                                    <th>á—áŸá‘</th>
                                    <th>á–áŸá›áœáŸá›á¶</th>
                                    <th>á€á¶á›á”ášá·á…áŸ’á†áŸá‘</th>
                                    <th>á”áŸ’ášá—áŸá‘</th>
                                </tr>
                            </thead>
                            <tbody id="report-table-body">
                                <!-- Data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    <div id="table-empty" class="empty-state" style="display: none;">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <h3>á˜á·á“á˜á¶á“á‘á·á“áŸ’á“á“áŸá™</h3>
                        <p>á˜á·á“á˜á¶á“á‘á·á“áŸ’á“á“áŸá™áŸáŸ’á€áŸá“áŸá˜áŸ’ášá¶á”áŸ‹á”áŸ’ášá—áŸá‘á“áŸáŸ‡á“áŸ…á¡á¾á™</p>
                    </div>
                    <div id="table-loading" class="empty-state">
                        <div class="loading"></div>
                        <p>á€áŸ†á–á»á„á•áŸ’á‘á»á€á‘á·á“áŸ’á“á“áŸá™...</p>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="button-grid">
                <button class="btn btn-info" onclick="refreshData()">
                    ğŸ”„ á•áŸ’á‘á»á€á‘á·á“áŸ’á“á“áŸá™á¡á¾á„áœá·á‰
                </button>
                <button class="btn btn-warning" onclick="clearAllData()">
                    ğŸ—‘ï¸ á›á»á”á‘á·á“áŸ’á“á“áŸá™á‘á¶áŸ†á„á¢áŸáŸ‹
                </button>
                <button class="btn btn-danger" onclick="logout()">
                    ğŸšª á…á¶á€á…áŸá‰
                </button>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://ovvlshbuayykddqrnoqx.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92dmxzaGJ1YXl5a2RkcXJub3F4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3NjQxODgsImV4cCI6MjA3NjM0MDE4OH0.vWLDFMS16PwZga9mYehVUiL6G0ccnRzdc9OUf2OM76I';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Global variables
        let currentReportType = null;
        let allReports = [];
        let filteredReports = [];
        let chart = null;
        let students = [];

        // Report type definitions
        const reportTypes = {
            late: {
                title: "áŸá·áŸáŸ’áŸá˜á€á™áºá",
                description: "ášá”á¶á™á€á¶ášááŸáŸá·áŸáŸ’áŸáŠáŸ‚á›á˜á€á™áºá á˜á·á“á‚áŸ„ášá–á‘á„áŸ‹á‡á¶áá·",
                table: "attendance_reports",
                type: "late",
                badge: "badge-late",
                badgeText: "á˜á€á™áºá"
            },
            discipline: {
                title: "áŸá·áŸáŸ’áŸá˜á·á“á‚áŸ„ášá–áœá·á“áŸá™",
                description: "ášá”á¶á™á€á¶ášááŸáŸá·áŸáŸ’áŸáŠáŸ‚á›á˜á·á“á‚áŸ„ášá–áœá·á“áŸá™áŸá¶á›á¶",
                table: "discipline_reports",
                type: "discipline",
                badge: "badge-discipline",
                badgeText: "á˜á·á“á‚áŸ„ášá–áœá·á“áŸá™"
            },
            helpful: {
                title: "áŸá·áŸáŸ’áŸá‡á½á™á€á¶ášá„á¶áš",
                description: "ášá”á¶á™á€á¶ášááŸáŸá·áŸáŸ’áŸáŠáŸ‚á›á”á¶á“á‡á½á™á€á¶ášá„á¶ášáŸá¶á›á¶",
                table: "helpful_reports",
                type: "helpful",
                badge: "badge-helpful",
                badgeText: "á‡á½á™á€á¶ášá„á¶áš"
            },
            haircut: {
                title: "áŸá·áŸáŸ’áŸááŸ’ášá¼áœá€á¶ááŸ‹áŸá€áŸ‹",
                description: "ášá”á¶á™á€á¶ášááŸáŸá·áŸáŸ’áŸáŠáŸ‚á›ááŸ’ášá¼áœá€á¶ááŸ‹áŸá€áŸ‹áá¶á˜áœá·á“áŸá™",
                table: "haircut_reports",
                type: "haircut",
                badge: "badge-haircut",
                badgeText: "ááŸ’ášá¼áœá€á¶ááŸ‹áŸá€áŸ‹"
            }
        };

        // á‡áŸ’ášá¾áŸášá¾áŸá”áŸ’ášá—áŸá‘ášá”á¶á™á€á¶ášááŸ
        function selectReportType(type) {
            // Remove selected class from all cards
            document.querySelectorAll('.report-type-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selected class to clicked card
            document.querySelector(`.report-type-card[data-type="${type}"]`).classList.add('selected');
            
            // Store selected type
            currentReportType = type;
            
            // Update current report type display
            document.getElementById('current-report-title').textContent = `ášá”á¶á™á€á¶ášááŸ${reportTypes[type].title}`;
            document.getElementById('current-report-description').textContent = reportTypes[type].description;
            document.getElementById('current-report-type').style.display = 'block';
            
            // Show filter section
            document.getElementById('filter-section').style.display = 'block';
            
            // Load data for selected report type
            loadReportData();
            
            console.log(`âœ… Selected report type: ${type} - ${reportTypes[type].title}`);
        }

        // á•áŸ’á‘á»á€á‘á·á“áŸ’á“á“áŸá™ášá”á¶á™á€á¶ášááŸ
        async function loadReportData() {
            if (!currentReportType) return;
            
            // Show loading state
            document.getElementById('table-loading').style.display = 'block';
            document.getElementById('table-empty').style.display = 'none';
            document.getElementById('report-table-body').innerHTML = '';
            
            try {
                const tableName = reportTypes[currentReportType].table;
                console.log(`ğŸ” Loading data from ${tableName}...`);
                
                // Try to fetch from Supabase first
                const { data, error } = await supabase
                    .from(tableName)
                    .select('*')
                    .order('timestamp', { ascending: false });
                
                if (error) {
                    // If table doesn't exist, try localStorage
                    if (error.code === 'PGRST301') {
                        console.log(`Table ${tableName} doesn't exist, trying localStorage...`);
                        allReports = JSON.parse(localStorage.getItem(`${currentReportType}Reports`) || '[]');
                    } else {
                        throw error;
                    }
                } else {
                    allReports = data || [];
                    console.log(`âœ… Loaded ${allReports.length} records from Supabase`);
                }
                
                // Apply initial filters
                applyFilters();
                
                // Update stats
                updateStats();
                
                // Update chart
                updateChart();
                
                // Populate class filter
                populateClassFilter();
                
            } catch (error) {
                console.error('âŒ Error loading report data:', error);
                
                // Fallback to localStorage
                allReports = JSON.parse(localStorage.getItem(`${currentReportType}Reports`) || '[]');
                console.log(`ğŸ“± Fallback to localStorage: ${allReports.length} records`);
                
                applyFilters();
                updateStats();
                updateChart();
                populateClassFilter();
            }
        }

        // ááŸ’ášá„á‘á·á“áŸ’á“á“áŸá™
        function applyFilters() {
            if (!currentReportType || allReports.length === 0) {
                document.getElementById('table-loading').style.display = 'none';
                document.getElementById('table-empty').style.display = 'block';
                return;
            }
            
            let filtered = [...allReports];
            
            // Apply date filter
            const dateFilter = document.getElementById('date-filter').value;
            const today = new Date();
            
            switch (dateFilter) {
                case 'today':
                    const todayStr = today.toISOString().split('T')[0];
                    filtered = filtered.filter(report => report.date === todayStr);
                    break;
                case 'yesterday':
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    const yesterdayStr = yesterday.toISOString().split('T')[0];
                    filtered = filtered.filter(report => report.date === yesterdayStr);
                    break;
                case 'week':
                    const weekAgo = new Date(today);
                    weekAgo.setDate(weekAgo.getDate() - 7);
                    filtered = filtered.filter(report => {
                        const reportDate = new Date(report.date);
                        return reportDate >= weekAgo && reportDate <= today;
                    });
                    break;
                case 'month':
                    const monthAgo = new Date(today);
                    monthAgo.setMonth(monthAgo.getMonth() - 1);
                    filtered = filtered.filter(report => {
                        const reportDate = new Date(report.date);
                        return reportDate >= monthAgo && reportDate <= today;
                    });
                    break;
                case 'custom':
                    const customDate = document.getElementById('custom-date').value;
                    if (customDate) {
                        filtered = filtered.filter(report => report.date === customDate);
                    }
                    break;
            }
            
            // Apply class filter
            const classFilter = document.getElementById('class-filter').value;
            if (classFilter !== 'all') {
                filtered = filtered.filter(report => report.class === classFilter);
            }
            
            // Apply search filter
            const searchFilter = document.getElementById('search-filter').value.toLowerCase();
            if (searchFilter) {
                filtered = filtered.filter(report => 
                    report.name.toLowerCase().includes(searchFilter) ||
                    report.student_id.toLowerCase().includes(searchFilter)
                );
            }
            
            filteredReports = filtered;
            renderTable();
            updateStats();
            updateChart();
        }

        // á”á„áŸ’á á¶á‰áá¶ášá¶á„
        function renderTable() {
            const tableBody = document.getElementById('report-table-body');
            const tableLoading = document.getElementById('table-loading');
            const tableEmpty = document.getElementById('table-empty');
            
            tableLoading.style.display = 'none';
            
            if (filteredReports.length === 0) {
                tableEmpty.style.display = 'block';
                tableBody.innerHTML = '';
                return;
            }
            
            tableEmpty.style.display = 'none';
            
            let html = '';
            filteredReports.forEach((report, index) => {
                // Format date for display
                const dateObj = new Date(report.date);
                const displayDate = dateObj.toLocaleDateString('km-KH', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>
                            <div><strong>${report.name}</strong></div>
                            <div style="font-size: 0.8rem; color: var(--gray);">ID: ${report.student_id}</div>
                        </td>
                        <td>${report.class}</td>
                        <td>${report.gender || 'á˜á·á“á˜á¶á“á‘á·á“áŸ’á“á“áŸá™'}</td>
                        <td>${report.scan_time || report.late_time || 'N/A'}</td>
                        <td>${displayDate}</td>
                        <td><span class="badge ${reportTypes[currentReportType].badge}">${reportTypes[currentReportType].badgeText}</span></td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
            document.getElementById('table-section').style.display = 'block';
        }

        // á’áŸ’áœá¾á”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“á—á¶á–áŸáŸ’áá·áá·
        function updateStats() {
            if (!currentReportType) return;
            
            const totalScans = allReports.length;
            const todayScans = allReports.filter(report => {
                const today = new Date().toISOString().split('T')[0];
                return report.date === today;
            }).length;
            
            // Count unique students
            const uniqueStudents = new Set(allReports.map(report => report.student_id)).size;
            
            // Find most frequent student
            const studentCounts = {};
            allReports.forEach(report => {
                studentCounts[report.student_id] = (studentCounts[report.student_id] || 0) + 1;
            });
            
            const mostFrequent = Math.max(...Object.values(studentCounts), 0);
            
            document.getElementById('total-scans').textContent = totalScans;
            document.getElementById('today-scans').textContent = todayScans;
            document.getElementById('unique-students').textContent = uniqueStudents;
            document.getElementById('most-frequent').textContent = mostFrequent;
            
            document.getElementById('stats-section').style.display = 'grid';
        }

        // á’áŸ’áœá¾á”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“á—á¶á–áá¶ášá¶á„
        function updateChart() {
            if (!currentReportType || filteredReports.length === 0) {
                document.getElementById('chart-section').style.display = 'none';
                return;
            }
            
            document.getElementById('chart-section').style.display = 'block';
            
            // Prepare data for chart - last 7 days
            const last7Days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                last7Days.push(date.toISOString().split('T')[0]);
            }
            
            const dailyCounts = last7Days.map(date => {
                return filteredReports.filter(report => report.date === date).length;
            });
            
            const chartLabels = last7Days.map(date => {
                const d = new Date(date);
                return d.toLocaleDateString('km-KH', { month: 'short', day: 'numeric' });
            });
            
            const ctx = document.getElementById('reportChart').getContext('2d');
            
            // Destroy existing chart
            if (chart) {
                chart.destroy();
            }
            
            // Create new chart
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: `á…áŸ†á“á½á“áŸáŸ’á€áŸá“${reportTypes[currentReportType].title}`,
                        data: dailyCounts,
                        backgroundColor: '#4361ee',
                        borderColor: '#3a56d4',
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: `áŸáŸ’áá·áá·áŸáŸ’á€áŸá“${reportTypes[currentReportType].title} áŸ§ááŸ’á„áŸƒá…á»á„á€áŸ’ášáŸ„á™`,
                            font: {
                                size: 16,
                                family: 'Khmer OS, Noto Sans Khmer, Arial'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            },
                            title: {
                                display: true,
                                text: 'á…áŸ†á“á½á“áŸáŸ’á€áŸá“'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'á€á¶á›á”ášá·á…áŸ’á†áŸá‘'
                            }
                        }
                    }
                }
            });
        }

        // á”áŸ†á–áŸá‰áá˜áŸ’ášáŸ€á”ááŸ’á“á¶á€áŸ‹
        function populateClassFilter() {
            const classFilter = document.getElementById('class-filter');
            
            // Get unique classes from reports
            const classes = [...new Set(allReports.map(report => report.class))].sort();
            
            // Clear existing options except "all"
            classFilter.innerHTML = '<option value="all">á‘á¶áŸ†á„á¢áŸáŸ‹</option>';
            
            // Add class options
            classes.forEach(className => {
                const option = document.createElement('option');
                option.value = className;
                option.textContent = className;
                classFilter.appendChild(option);
            });
        }

        // á“á¶áŸ†á…áŸá‰á‘áŸ…á‡á¶ Excel
        function exportToExcel() {
            if (filteredReports.length === 0) {
                alert('â— á˜á·á“á˜á¶á“á‘á·á“áŸ’á“á“áŸá™áŠá¾á˜áŸ’á”á¸á“á¶áŸ†á…áŸá‰');
                return;
            }
            
            try {
                // Prepare data for Excel
                const excelData = filteredReports.map((report, index) => {
                    const dateObj = new Date(report.date);
                    const displayDate = dateObj.toLocaleDateString('km-KH', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    
                    return {
                        'á›.áš': index + 1,
                        'áˆáŸ’á˜áŸ„áŸ‡áŸá·áŸáŸ’áŸ': report.name,
                        'á¢ááŸ’áá›áŸá': report.student_id,
                        'ááŸ’á“á¶á€áŸ‹': report.class,
                        'á—áŸá‘': report.gender || 'á˜á·á“á˜á¶á“á‘á·á“áŸ’á“á“áŸá™',
                        'á–áŸá›áœáŸá›á¶': report.scan_time || report.late_time || 'N/A',
                        'á€á¶á›á”ášá·á…áŸ’á†áŸá‘': displayDate,
                        'á”áŸ’ášá—áŸá‘': reportTypes[currentReportType].badgeText
                    };
                });
                
                // Create worksheet
                const ws = XLSX.utils.json_to_sheet(excelData);
                
                // Create workbook
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, reportTypes[currentReportType].title);
                
                // Generate filename
                const today = new Date().toISOString().split('T')[0];
                const filename = `${reportTypes[currentReportType].title}_${today}.xlsx`;
                
                // Export to Excel
                XLSX.writeFile(wb, filename);
                
                console.log(`âœ… Exported ${filteredReports.length} records to Excel`);
            } catch (error) {
                console.error('âŒ Error exporting to Excel:', error);
                alert('â— á€áŸ†á á»áŸá€áŸ’á“á»á„á€á¶ášá“á¶áŸ†á…áŸá‰á‘á·á“áŸ’á“á“áŸá™: ' + error.message);
            }
        }

        // á”áŸ„áŸ‡á–á»á˜áŸ’á–ášá”á¶á™á€á¶ášááŸ
        function printReport() {
            if (filteredReports.length === 0) {
                alert('â— á˜á·á“á˜á¶á“á‘á·á“áŸ’á“á“áŸá™áŠá¾á˜áŸ’á”á¸á”áŸ„áŸ‡á–á»á˜áŸ’á–');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            const today = new Date().toLocaleDateString('km-KH');
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="km">
                <head>
                    <meta charset="UTF-8">
                    <title>ášá”á¶á™á€á¶ášááŸ${reportTypes[currentReportType].title}</title>
                    <style>
                        body { font-family: 'Khmer OS', 'Arial', sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }
                        .header h1 { color: #333; margin-bottom: 10px; }
                        .header .date { color: #666; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
                        th { background-color: #f5f5f5; font-weight: bold; }
                        .summary { margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 5px; }
                        .footer { margin-top: 30px; text-align: center; color: #666; font-size: 0.9em; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ášá”á¶á™á€á¶ášááŸ${reportTypes[currentReportType].title}</h1>
                        <div class="date">á€á¶á›á”ášá·á…áŸ’á†áŸá‘: ${today}</div>
                        <div class="date">á…áŸ†á“á½á“áŸáŸ’á€áŸá“áŸášá»á”: ${filteredReports.length}</div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>á›.áš</th>
                                <th>áˆáŸ’á˜áŸ„áŸ‡áŸá·áŸáŸ’áŸ</th>
                                <th>ááŸ’á“á¶á€áŸ‹</th>
                                <th>á—áŸá‘</th>
                                <th>á–áŸá›áœáŸá›á¶</th>
                                <th>á€á¶á›á”ášá·á…áŸ’á†áŸá‘</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredReports.map((report, index) => {
                                const dateObj = new Date(report.date);
                                const displayDate = dateObj.toLocaleDateString('km-KH', {
                                    year: 'numeric',
                                    month: 'long',
                                    day: 'numeric'
                                });
                                
                                return `
                                    <tr>
                                        <td>${index + 1}</td>
                                        <td>${report.name}<br><small>ID: ${report.student_id}</small></td>
                                        <td>${report.class}</td>
                                        <td>${report.gender || 'á˜á·á“á˜á¶á“á‘á·á“áŸ’á“á“áŸá™'}</td>
                                        <td>${report.scan_time || report.late_time || 'N/A'}</td>
                                        <td>${displayDate}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                    <div class="footer">
                        <p>á”áŸ’ášá–áŸá“áŸ’á’á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„áŸáŸ’á€áŸá“áŸá·áŸáŸ’áŸ - á”á¶á“á”á„áŸ’á€á¾áá¡á¾á„á“áŸ… ${new Date().toLocaleString('km-KH')}</p>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
            printWindow.close();
        }

        // á•áŸ’á‘á»á€á‘á·á“áŸ’á“á“áŸá™á¡á¾á„áœá·á‰
        function refreshData() {
            if (!currentReportType) {
                alert('â— áŸá¼á˜á‡áŸ’ášá¾áŸášá¾áŸá”áŸ’ášá—áŸá‘ášá”á¶á™á€á¶ášááŸá˜á»á“');
                return;
            }
            loadReportData();
        }

        // á›á»á”á‘á·á“áŸ’á“á“áŸá™á‘á¶áŸ†á„á¢áŸáŸ‹
        async function clearAllData() {
            if (!currentReportType) {
                alert('â— áŸá¼á˜á‡áŸ’ášá¾áŸášá¾áŸá”áŸ’ášá—áŸá‘ášá”á¶á™á€á¶ášááŸá˜á»á“');
                return;
            }
            
            if (!confirm(`áá¾á¢áŸ’á“á€á–á·áá‡á¶á…á„áŸ‹á›á»á”á‘á·á“áŸ’á“á“áŸá™${reportTypes[currentReportType].title}á‘á¶áŸ†á„á¢áŸáŸ‹á˜áŸ‚á“á‘áŸ? áŸá€á˜áŸ’á˜á—á¶á–á“áŸáŸ‡á˜á·á“á¢á¶á…ááŸ’ášá¡á”áŸ‹á€áŸ’ášáŸ„á™á”á¶á“á‘áŸ!`)) {
                return;
            }
            
            try {
                const tableName = reportTypes[currentReportType].table;
                
                // Delete from Supabase
                const { error } = await supabase
                    .from(tableName)
                    .delete()
                    .neq('id', 0); // Delete all records
                
                if (error && error.code !== 'PGRST301') { // Ignore if table doesn't exist
                    throw error;
                }
                
                // Delete from localStorage
                localStorage.removeItem(`${currentReportType}Reports`);
                
                // Reset data
                allReports = [];
                filteredReports = [];
                
                // Update UI
                renderTable();
                updateStats();
                updateChart();
                
                alert(`âœ… á‘á·á“áŸ’á“á“áŸá™${reportTypes[currentReportType].title}á‘á¶áŸ†á„á¢áŸáŸ‹ááŸ’ášá¼áœá”á¶á“á›á»á”ášá½á…ášá¶á›áŸ‹`);
                
            } catch (error) {
                console.error('âŒ Error clearing data:', error);
                alert('â— á€áŸ†á á»áŸá€áŸ’á“á»á„á€á¶ášá›á»á”á‘á·á“áŸ’á“á“áŸá™: ' + error.message);
            }
        }

        // á…á¶á€á…áŸá‰
        function logout() {
            localStorage.removeItem('adminLoggedIn');
            window.location.href = 'login.html';
        }

        // á‘áŸ…á€á¶á“áŸ‹á‘áŸ†á–áŸášáŠá¾á˜
        function goToHome() {
            window.location.href = 'index.html';
        }

        // á‘áŸ…á€á¶á“áŸ‹á‘áŸ†á–áŸášáŸáŸ’á€áŸá“
        function goToScanner() {
            window.location.href = 'scanner.html';
        }

        // Handle date filter change
        document.getElementById('date-filter').addEventListener('change', function() {
            const customDateGroup = document.getElementById('custom-date-group');
            if (this.value === 'custom') {
                customDateGroup.style.display = 'block';
            } else {
                customDateGroup.style.display = 'none';
                applyFilters();
            }
        });

        // Initialize page
        window.onload = function() {
            console.log('ğŸ“Š Report page loaded');
            // No report type selected by default
        };
    </script>
</body>
</html>
